<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tr·ª£ L√Ω C√¥ng Vi·ªác - Emotion Detection</title>
    
    <!-- Face-api.js Library - Use jsdelivr CDN for better reliability -->
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/productivity.css">
</head>
<body>
    <!-- Navigation Tabs -->
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="emotion">üé≠ Nh·∫≠n Di·ªán C·∫£m X√∫c</button>
        <button class="tab-btn" data-tab="productivity">üíº H·ªó Tr·ª£ C√¥ng Vi·ªác</button>
        <button class="tab-btn" data-tab="analytics">üìä Th·ªëng K√™</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <header>
            <h1 id="mainTitle">üé≠ AI Tr·ª£ L√Ω C√¥ng Vi·ªác</h1>
            <p class="subtitle">Nh·∫≠n di·ªán c·∫£m x√∫c & h·ªó tr·ª£ nƒÉng su·∫•t l√†m vi·ªác v·ªõi AI</p>
        </header>

        <!-- Loading Status -->
        <div id="status" class="status">
            <span id="statusText">ƒêang t·∫£i m√¥ h√¨nh AI...</span>
            <div class="loader"></div>
        </div>

        <!-- Video & Canvas Container -->
        <div class="video-container">
            <video id="video" autoplay muted playsinline></video>
            <canvas id="canvas"></canvas>
        </div>

        <!-- Control Buttons -->
        <div class="controls">
            <button id="startBtn" disabled>
                <span class="btn-icon">‚ñ∂Ô∏è</span>
                <span class="btn-text">B·∫Øt ƒê·∫ßu</span>
            </button>
            <button id="stopBtn" disabled>
                <span class="btn-icon">‚èπÔ∏è</span>
                <span class="btn-text">D·ª´ng L·∫°i</span>
            </button>
        </div>

        <!-- Emotion Display -->
        <div id="emotionDisplay" class="emotion-display">
            <div id="emotionEmoji" class="emotion-emoji">ü§ñ</div>
            <div id="emotionText" class="emotion-text">ƒêang ch·ªù...</div>
            <div id="emotionMessage" class="emotion-message">Nh·∫•n "B·∫Øt ƒê·∫ßu" ƒë·ªÉ nh·∫≠n di·ªán c·∫£m x√∫c</div>
        </div>

        <!-- Statistics -->
        <div id="stats" class="stats">
            <div class="stat-item">
                <span class="stat-label">FPS:</span>
                <span id="fps" class="stat-value">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ƒê·ªô ch√≠nh x√°c:</span>
                <span id="confidence" class="stat-value">0%</span>
            </div>
        </div>

        <!-- ============================================
             PRODUCTIVITY TAB - H·ªñ TR·ª¢ C√îNG VI·ªÜC
        ============================================ -->
        <div id="productivityTab" class="tab-content" style="display: none;">
            <!-- Tr·∫°ng th√°i l√†m vi·ªác -->
            <div id="workState" class="section-card">
                <h2>üìä Tr·∫°ng Th√°i L√†m Vi·ªác</h2>
                <p class="hint">ƒêang ph√¢n t√≠ch tr·∫°ng th√°i c·ªßa b·∫°n...</p>
            </div>

            <!-- Pomodoro Timer -->
            <div class="section-card">
                <h2>üçÖ Pomodoro Timer</h2>
                <div id="pomodoroTimer">
                    <p class="hint">Timer s·∫Ω xu·∫•t hi·ªán khi b·∫°n b·∫Øt ƒë·∫ßu nh·∫≠n di·ªán</p>
                </div>
            </div>

            <!-- Ghi ch√∫ c√¥ng vi·ªác -->
            <div class="section-card">
                <h2>üìù Ghi Ch√∫ C√¥ng Vi·ªác</h2>
                <div class="note-input-group">
                    <input type="text" id="noteInput" placeholder="Th√™m ghi ch√∫ v·ªÅ c√¥ng vi·ªác..." />
                    <button onclick="addNote()" class="btn-primary">‚ûï Th√™m</button>
                </div>
                <div id="workNotes" class="work-notes-container">
                    <p class="no-notes">Ch∆∞a c√≥ ghi ch√∫ n√†o. Th√™m ghi ch√∫ ƒë·∫ßu ti√™n!</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section-card">
                <h2>‚ö° H√†nh ƒê·ªông Nhanh</h2>
                <div class="quick-actions">
                    <button onclick="productivityTracker.exportData()" class="action-btn">
                        üíæ Xu·∫•t b√°o c√°o
                    </button>
                    <button onclick="productivityTracker.resetData()" class="action-btn danger">
                        üóëÔ∏è X√≥a d·ªØ li·ªáu
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             ANALYTICS TAB - TH·ªêNG K√ä
        ============================================ -->
        <div id="analyticsTab" class="tab-content" style="display: none;">
            <!-- Th·ªëng k√™ t·ªïng quan -->
            <div class="section-card">
                <h2>üìà Th·ªëng K√™ NƒÉng Su·∫•t</h2>
                <div id="productivityStats">
                    <p class="hint">Th·ªëng k√™ s·∫Ω xu·∫•t hi·ªán khi b·∫°n b·∫Øt ƒë·∫ßu l√†m vi·ªác</p>
                </div>
            </div>

            <!-- Bi·ªÉu ƒë·ªì c·∫£m x√∫c -->
            <div class="section-card">
                <h2>üé≠ Ph√¢n B·ªë C·∫£m X√∫c</h2>
                <div id="emotionChart" class="emotion-chart">
                    <p class="hint">Bi·ªÉu ƒë·ªì s·∫Ω xu·∫•t hi·ªán sau khi thu th·∫≠p d·ªØ li·ªáu</p>
                </div>
            </div>

            <!-- L·ªãch s·ª≠ c·∫£m x√∫c -->
            <div class="section-card">
                <h2>üìä L·ªãch S·ª≠ C·∫£m X√∫c</h2>
                <div id="emotionTimeline" class="emotion-timeline">
                    <p class="hint">Timeline s·∫Ω hi·ªÉn th·ªã l·ªãch s·ª≠ c·∫£m x√∫c c·ªßa b·∫°n</p>
                </div>
            </div>

            <!-- Tips & Recommendations -->
            <div class="section-card">
                <h2>üí° G·ª£i √ù C·∫£i Thi·ªán</h2>
                <div id="recommendations" class="recommendations">
                    <div class="tip-card">
                        <div class="tip-icon">üéØ</div>
                        <div class="tip-text">H√£y duy tr√¨ tr·∫°ng th√°i t·∫≠p trung b·∫±ng k·ªπ thu·∫≠t Pomodoro</div>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">‚òï</div>
                        <div class="tip-text">Ngh·ªâ ng∆°i 5-10 ph√∫t sau m·ªói 25 ph√∫t l√†m vi·ªác</div>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">üòå</div>
                        <div class="tip-text">Th·ª±c hi·ªán b√†i t·∫≠p th·ªü s√¢u khi c·∫£m th·∫•y cƒÉng th·∫≥ng</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Audio Elements -->
    <audio id="happySound" loop></audio>
    <audio id="sadSound" loop></audio>
    <audio id="calmSound" loop></audio>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/emotions.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/productivity.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Tab Switching Script -->
    <script>
        // Tab Navigation
        document.addEventListener('DOMContentLoaded', () => {
            const tabBtns = document.querySelectorAll('.tab-btn');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabName = btn.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        });
        
        function switchTab(tabName) {
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Hide all tab contents
            const emotionContent = document.querySelector('.video-container').parentElement;
            document.getElementById('productivityTab').style.display = 'none';
            document.getElementById('analyticsTab').style.display = 'none';
            
            // Show emotion detection elements
            const emotionElements = [
                '.video-container', '.controls', '#emotionDisplay', '#stats'
            ];
            
            // Show selected tab
            if (tabName === 'emotion') {
                emotionElements.forEach(selector => {
                    const el = document.querySelector(selector);
                    if (el) el.style.display = '';
                });
            } else if (tabName === 'productivity') {
                emotionElements.forEach(selector => {
                    const el = document.querySelector(selector);
                    if (el) el.style.display = 'none';
                });
                document.getElementById('productivityTab').style.display = 'block';
            } else if (tabName === 'analytics') {
                emotionElements.forEach(selector => {
                    const el = document.querySelector(selector);
                    if (el) el.style.display = 'none';
                });
                document.getElementById('analyticsTab').style.display = 'block';
                updateAnalytics();
            }
        }
        
        function addNote() {
            const input = document.getElementById('noteInput');
            const note = input.value.trim();
            
            if (note && productivityTracker) {
                productivityTracker.addWorkNote(note);
                input.value = '';
            } else if (!note) {
                alert('Vui l√≤ng nh·∫≠p n·ªôi dung ghi ch√∫!');
            }
        }
        
        function updateAnalytics() {
            if (!productivityTracker) return;
            
            // Update stats
            productivityTracker.updateStatsDisplay();
            
            // Update emotion chart
            const chartData = productivityTracker.generateEmotionChart();
            const chartContainer = document.getElementById('emotionChart');
            
            if (chartData.length > 0) {
                const chartHTML = chartData.map(item => `
                    <div class="chart-bar">
                        <div class="chart-label">${productivityTracker.getEmotionEmoji(item.emotion)} ${item.emotion}</div>
                        <div class="chart-bar-bg">
                            <div class="chart-bar-fill" style="width: ${item.percentage}%"></div>
                        </div>
                        <div class="chart-value">${item.percentage}%</div>
                    </div>
                `).join('');
                
                chartContainer.innerHTML = chartHTML;
            }
            
            // Update timeline
            updateEmotionTimeline();
        }
        
        function updateEmotionTimeline() {
            if (!productivityTracker) return;
            
            const timeline = document.getElementById('emotionTimeline');
            const history = productivityTracker.emotionHistory.slice(-10).reverse();
            
            if (history.length === 0) {
                timeline.innerHTML = '<p class="hint">Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠</p>';
                return;
            }
            
            const timelineHTML = history.map(item => {
                const date = new Date(item.timestamp);
                const emoji = productivityTracker.getEmotionEmoji(item.emotion);
                
                return `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <span class="timeline-emoji">${emoji}</span>
                            <span class="timeline-emotion">${item.emotion}</span>
                            <span class="timeline-score">T·∫≠p trung: ${item.focusScore}/100</span>
                            <span class="timeline-time">${date.toLocaleTimeString('vi-VN')}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            timeline.innerHTML = timelineHTML;
        }
        
        // Allow Enter key to add note
        document.addEventListener('DOMContentLoaded', () => {
            const noteInput = document.getElementById('noteInput');
            if (noteInput) {
                noteInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addNote();
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tr·ª£ L√Ω C√¥ng Vi·ªác - Enhanced Edition</title>
    
    <!-- Meta tags for better performance -->
    <meta name="description" content="·ª®ng d·ª•ng AI nh·∫≠n di·ªán c·∫£m x√∫c v√† h·ªó tr·ª£ nƒÉng su·∫•t c√¥ng vi·ªác">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://unpkg.com">
    
    <!-- Face-api.js Library - Enhanced loading with fallback -->
    <script>
        // Enhanced face-api loading with fallback
        (function() {
            const scripts = [
                'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js',
                'https://unpkg.com/@vladmandic/face-api@latest/dist/face-api.min.js'
            ];
            
            let loaded = false;
            let attempts = 0;
            
            function loadScript(url) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = url;
                    script.defer = true;
                    script.onload = () => {
                        console.log('Face-API loaded from:', url);
                        loaded = true;
                        resolve();
                    };
                    script.onerror = () => {
                        console.warn('Failed to load Face-API from:', url);
                        reject();
                    };
                    document.head.appendChild(script);
                });
            }
            
            async function tryLoadFaceAPI() {
                for (const url of scripts) {
                    try {
                        await loadScript(url);
                        return;
                    } catch (error) {
                        continue;
                    }
                }
                
                // All attempts failed
                console.error('Failed to load Face-API from all CDNs');
                document.addEventListener('DOMContentLoaded', () => {
                    const statusText = document.getElementById('statusText');
                    if (statusText) {
                        statusText.textContent = 'Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán AI. Ki·ªÉm tra k·∫øt n·ªëi m·∫°ng v√† t·∫£i l·∫°i trang!';
                    }
                });
            }
            
            tryLoadFaceAPI();
        })();
    </script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/productivity.css">
    
    <!-- Enhanced styles for better error handling -->
    <style>
        .system-info {
            background: #f0f8ff;
            border: 1px solid #b0d4ff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .error-details {
            background: #ffe6e6;
            border: 1px solid #ffb3b3;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #d63384;
        }
        
        .camera-help {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #856404;
        }
        
        .camera-help ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .camera-help li {
            margin: 5px 0;
        }
        
        .restart-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            animation: pulse 2s infinite;
        }
        
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .backend-info {
            display: inline-block;
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .performance-monitor {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 11px;
            z-index: 1000;
            min-width: 120px;
        }
        
        .troubleshooting {
            background: #e8f4f8;
            border: 1px solid #b3e0f2;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .troubleshooting h4 {
            color: #0c5460;
            margin-top: 0;
        }
        
        .troubleshooting ol {
            margin: 10px 0;
            padding-left: 25px;
        }
        
        .troubleshooting li {
            margin: 8px 0;
            line-height: 1.4;
        }
        
        .feature-unavailable {
            opacity: 0.6;
            pointer-events: none;
            background: #f8f9fa !important;
            color: #6c757d !important;
        }
        
        .feature-unavailable::after {
            content: " (Kh√¥ng kh·∫£ d·ª•ng)";
            font-style: italic;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- System Performance Monitor -->
    <div id="performanceMonitor" class="performance-monitor">
        <div id="fps">-- FPS</div>
        <div id="backend">Backend: --</div>
        <div id="memory">RAM: --</div>
    </div>

    <!-- Navigation Tabs -->
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="emotion">üé≠ Nh·∫≠n Di·ªán C·∫£m X√∫c</button>
        <button class="tab-btn" data-tab="productivity">üíº H·ªó Tr·ª£ C√¥ng Vi·ªác</button>
        <button class="tab-btn" data-tab="analytics">üìä Th·ªëng K√™</button>
        <button class="tab-btn" data-tab="assistant">ü§ñ AI Tr·ª£ L√Ω</button>
        <button class="tab-btn" data-tab="database">üíæ Database & API</button>
    </div>

    <!-- AI Chat Button (Floating) -->
    <button id="chatToggle" class="chat-toggle" onclick="toggleChat()">
        üí¨
    </button>

    <!-- AI Chat Panel -->
    <div id="chatPanel" class="chat-panel">
        <div class="chat-header">
            <h3>ü§ñ AI Tr·ª£ L√Ω Th√¥ng Minh Pro</h3>
            <button onclick="toggleChat()" class="chat-close">‚úï</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message chat-message-bot">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <div class="message-text">
                        Xin ch√†o! T√¥i l√† AI Assistant Pro - phi√™n b·∫£n n√¢ng cao! üöÄ<br><br>
                        ‚úÖ Nh·∫≠n di·ªán c·∫£m x√∫c v·ªõi AI ti√™n ti·∫øn<br>
                        ‚úÖ Theo d√µi nƒÉng su·∫•t th√¥ng minh<br>
                        ‚úÖ H·ªó tr·ª£ database & API mi·ªÖn ph√≠<br>
                        ‚úÖ Th·ªëng k√™ chi ti·∫øt & b√°o c√°o<br>
                        ‚úÖ T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t l√†m vi·ªác<br>
                        ‚úÖ Ph√°t hi·ªán stress & ƒë·ªÅ xu·∫•t gi·∫£i ph√°p<br><br>
                        H√£y h·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨! üí™
                    </div>
                </div>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="H·ªèi AI Assistant..." maxlength="500">
            <button id="chatSend" onclick="sendMessage()">üì§</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <h1>ü§ñ AI Tr·ª£ L√Ω C√¥ng Vi·ªác - Enhanced Edition</h1>
        
        <!-- System Check Results -->
        <div id="systemCheck" class="system-info" style="display: none;">
            <h4>üîß Th√¥ng tin h·ªá th·ªëng:</h4>
            <div id="systemDetails"></div>
        </div>

        <!-- Emotion Detection Tab -->
        <div id="emotionTab" class="tab-content active">
            <div class="controls">
                <button id="startBtn" class="btn btn-primary" disabled>
                    üé• B·∫Øt ƒê·∫ßu Ph√¢n T√≠ch
                </button>
                <button id="stopBtn" class="btn btn-secondary" disabled>
                    ‚èπÔ∏è D·ª´ng L·∫°i
                </button>
                <button id="systemCheckBtn" class="btn btn-info" onclick="runSystemCheck()">
                    üîç Ki·ªÉm Tra H·ªá Th·ªëng
                </button>
            </div>

            <div class="status" id="status">
                <div id="statusText">ƒêang kh·ªüi t·∫°o AI Assistant Pro...</div>
            </div>

            <div class="video-container">
                <video id="video" autoplay muted playsinline></video>
                <canvas id="overlay"></canvas>
                
                <!-- Enhanced emotion display -->
                <div class="emotion-display" id="emotionDisplay">
                    <div class="emotion-main">
                        <div class="emotion-emoji" id="emotionEmoji">üé≠</div>
                        <div class="emotion-info">
                            <div class="emotion-label" id="emotionLabel">Ch·ªù ph√¢n t√≠ch...</div>
                            <div class="emotion-confidence" id="emotionConfidence"></div>
                        </div>
                    </div>
                    <div class="emotion-message" id="emotionMessage">
                        H∆∞·ªõng camera v·ªÅ m·∫∑t b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch c·∫£m x√∫c!
                    </div>
                    <div class="productivity-suggestion" id="productivitySuggestion"></div>
                </div>
            </div>

            <!-- Troubleshooting Guide -->
            <div id="troubleshooting" class="troubleshooting" style="display: none;">
                <h4>üîß H∆∞·ªõng d·∫´n kh·∫Øc ph·ª•c s·ª± c·ªë:</h4>
                <ol>
                    <li><strong>L·ªói WebGL:</strong> C·∫≠p nh·∫≠t driver card ƒë·ªì h·ªça ho·∫∑c s·ª≠ d·ª•ng tr√¨nh duy·ªát Chrome/Firefox m·ªõi nh·∫•t</li>
                    <li><strong>L·ªói Camera:</strong> C·∫•p quy·ªÅn truy c·∫≠p camera trong c√†i ƒë·∫∑t tr√¨nh duy·ªát</li>
                    <li><strong>L·ªói WASM:</strong> ƒê·∫£m b·∫£o k·∫øt n·ªëi internet ·ªïn ƒë·ªãnh, th·ª≠ ƒë·ªïi DNS v·ªÅ 8.8.8.8</li>
                    <li><strong>T·∫£i m√¥ h√¨nh ch·∫≠m:</strong> S·ª≠ d·ª•ng m·∫°ng wifi thay v√¨ 4G, ho·∫∑c VPN n·∫øu c·∫ßn</li>
                    <li><strong>Hi·ªáu su·∫•t ch·∫≠m:</strong> ƒê√≥ng c√°c tab/·ª©ng d·ª•ng kh√°c, gi·∫£m ch·∫•t l∆∞·ª£ng video</li>
                </ol>
                <button class="restart-btn" onclick="window.location.reload()">üîÑ T·∫£i L·∫°i Trang</button>
            </div>
        </div>

        <!-- Productivity Tab -->
        <div id="productivityTab" class="tab-content">
            <div class="productivity-dashboard">
                <h2>üíº H·ªó Tr·ª£ C√¥ng Vi·ªác Th√¥ng Minh</h2>
                
                <!-- Pomodoro Timer -->
                <div class="productivity-card">
                    <h3>üçÖ Pomodoro Timer</h3>
                    <div class="timer-display" id="pomodoroTimer">25:00</div>
                    <div class="timer-controls">
                        <button id="startPomodoro" class="btn btn-success">‚ñ∂Ô∏è B·∫Øt ƒê·∫ßu</button>
                        <button id="pausePomodoro" class="btn btn-warning">‚è∏Ô∏è T·∫°m D·ª´ng</button>
                        <button id="resetPomodoro" class="btn btn-secondary">üîÑ Reset</button>
                    </div>
                    <div class="timer-status" id="pomodoroStatus">S·∫µn s√†ng l√†m vi·ªác!</div>
                </div>

                <!-- Work Analytics -->
                <div class="productivity-card">
                    <h3>üìà Ph√¢n T√≠ch NƒÉng Su·∫•t</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="workTime">0h 0m</div>
                            <div class="stat-label">Th·ªùi gian l√†m vi·ªác</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="breakTime">0h 0m</div>
                            <div class="stat-label">Th·ªùi gian ngh·ªâ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="productivityScore">85%</div>
                            <div class="stat-label">ƒêi·ªÉm nƒÉng su·∫•t</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="focusLevel">Cao</div>
                            <div class="stat-label">M·ª©c ƒë·ªô t·∫≠p trung</div>
                        </div>
                    </div>
                </div>

                <!-- Emotion-based Recommendations -->
                <div class="productivity-card">
                    <h3>üéØ ƒê·ªÅ Xu·∫•t Th√¥ng Minh</h3>
                    <div id="smartRecommendations">
                        <p>H√£y b·∫Øt ƒë·∫ßu ph√¢n t√≠ch c·∫£m x√∫c ƒë·ªÉ nh·∫≠n ƒë·ªÅ xu·∫•t c√° nh√¢n h√≥a!</p>
                    </div>
                </div>

                <!-- Task Manager -->
                <div class="productivity-card">
                    <h3>‚úÖ Qu·∫£n L√Ω Nhi·ªám V·ª•</h3>
                    <div class="task-input">
                        <input type="text" id="taskInput" placeholder="Th√™m nhi·ªám v·ª• m·ªõi...">
                        <button id="addTask" class="btn btn-primary">‚ûï Th√™m</button>
                    </div>
                    <div id="taskList" class="task-list">
                        <!-- Tasks will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analyticsTab" class="tab-content">
            <div class="analytics-dashboard">
                <h2>üìä Th·ªëng K√™ & B√°o C√°o</h2>
                
                <!-- Emotion Analytics -->
                <div class="analytics-card">
                    <h3>üòä Ph√¢n T√≠ch C·∫£m X√∫c</h3>
                    <canvas id="emotionChart" width="400" height="200"></canvas>
                    <div class="emotion-stats" id="emotionStats">
                        <div class="stat">üòÑ Vui v·∫ª: <span>0%</span></div>
                        <div class="stat">üò¢ Bu·ªìn: <span>0%</span></div>
                        <div class="stat">üò° T·ª©c gi·∫≠n: <span>0%</span></div>
                        <div class="stat">üò≤ Ng·∫°c nhi√™n: <span>0%</span></div>
                        <div class="stat">üòê B√¨nh th∆∞·ªùng: <span>0%</span></div>
                    </div>
                </div>

                <!-- Productivity Trends -->
                <div class="analytics-card">
                    <h3>üìà Xu H∆∞·ªõng NƒÉng Su·∫•t</h3>
                    <canvas id="productivityChart" width="400" height="200"></canvas>
                </div>

                <!-- Daily Report -->
                <div class="analytics-card">
                    <h3>üìã B√°o C√°o H√¥m Nay</h3>
                    <div id="dailyReport">
                        <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫°o b√°o c√°o. H√£y s·ª≠ d·ª•ng ·ª©ng d·ª•ng trong √≠t nh·∫•t 10 ph√∫t!</p>
                    </div>
                    <button id="exportReport" class="btn btn-success">üì• Xu·∫•t B√°o C√°o</button>
                </div>
            </div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="assistantTab" class="tab-content">
            <div class="assistant-dashboard">
                <h2>ü§ñ AI Tr·ª£ L√Ω Th√¥ng Minh</h2>
                
                <!-- AI Capabilities -->
                <div class="assistant-card">
                    <h3>üöÄ Kh·∫£ NƒÉng AI</h3>
                    <div class="capabilities-grid">
                        <div class="capability-item">
                            <div class="capability-icon">üé≠</div>
                            <div class="capability-text">Nh·∫≠n di·ªán c·∫£m x√∫c real-time</div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">üìä</div>
                            <div class="capability-text">Ph√¢n t√≠ch nƒÉng su·∫•t l√†m vi·ªác</div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">üí°</div>
                            <div class="capability-text">ƒê·ªÅ xu·∫•t t·ªëi ∆∞u h√≥a th√¥ng minh</div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">üßò</div>
                            <div class="capability-text">Ph√°t hi·ªán stress & m·ªát m·ªèi</div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">‚è∞</div>
                            <div class="capability-text">Qu·∫£n l√Ω th·ªùi gian Pomodoro</div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">üìà</div>
                            <div class="capability-text">B√°o c√°o chi ti·∫øt & th·ªëng k√™</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="assistant-card">
                    <h3>‚ö° Thao T√°c Nhanh</h3>
                    <div class="quick-actions">
                        <button class="action-btn" onclick="askAI('Ph√¢n t√≠ch t√¢m tr·∫°ng hi·ªán t·∫°i c·ªßa t√¥i')">
                            üòä Ph√¢n t√≠ch t√¢m tr·∫°ng
                        </button>
                        <button class="action-btn" onclick="askAI('ƒê·ªÅ xu·∫•t l·ªãch l√†m vi·ªác h√¥m nay')">
                            üìÖ L√™n l·ªãch l√†m vi·ªác
                        </button>
                        <button class="action-btn" onclick="askAI('T√¥i c·∫£m th·∫•y m·ªát m·ªèi, l√†m g√¨ b√¢y gi·ªù?')">
                            üò¥ H·ªó tr·ª£ m·ªát m·ªèi
                        </button>
                        <button class="action-btn" onclick="askAI('B√†i t·∫≠p th·ªü ƒë·ªÉ gi·∫£m stress')">
                            üßò Th∆∞ gi√£n stress
                        </button>
                        <button class="action-btn" onclick="generateProductivityReport()">
                            üìä T·∫°o b√°o c√°o
                        </button>
                        <button class="action-btn" onclick="askAI('Tips tƒÉng nƒÉng su·∫•t l√†m vi·ªác')">
                            üí™ Tips nƒÉng su·∫•t
                        </button>
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="assistant-card">
                    <h3>üîÆ AI Insights</h3>
                    <div id="aiInsights">
                        <p>B·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng ·ª©ng d·ª•ng ƒë·ªÉ nh·∫≠n insights t·ª´ AI!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Database & API Tab -->
        <div id="databaseTab" class="tab-content">
            <div class="database-dashboard">
                <h2>üíæ Database & API Mi·ªÖn Ph√≠</h2>
                
                <!-- Data Storage -->
                <div class="database-card">
                    <h3>üóÑÔ∏è L∆∞u Tr·ªØ D·ªØ Li·ªáu</h3>
                    <div class="storage-info">
                        <div class="storage-item">
                            <strong>LocalStorage:</strong> <span id="localStorageSize">0 KB</span>
                            <button onclick="clearLocalStorage()" class="btn btn-warning btn-sm">üóëÔ∏è X√≥a</button>
                        </div>
                        <div class="storage-item">
                            <strong>IndexedDB:</strong> <span id="indexedDBSize">0 KB</span>
                            <button onclick="clearIndexedDB()" class="btn btn-warning btn-sm">üóëÔ∏è X√≥a</button>
                        </div>
                        <div class="storage-item">
                            <strong>Session Data:</strong> <span id="sessionSize">0 KB</span>
                            <button onclick="clearSession()" class="btn btn-warning btn-sm">üóëÔ∏è X√≥a</button>
                        </div>
                    </div>
                </div>

                <!-- Free APIs -->
                <div class="database-card">
                    <h3>üåê API Mi·ªÖn Ph√≠ T√≠ch H·ª£p</h3>
                    <div class="api-list">
                        <div class="api-item">
                            <strong>JSONPlaceholder:</strong> Test API cho d·ªØ li·ªáu m·∫´u
                            <button onclick="testAPI('jsonplaceholder')" class="btn btn-primary btn-sm">üß™ Test</button>
                        </div>
                        <div class="api-item">
                            <strong>OpenWeatherMap:</strong> D·ªØ li·ªáu th·ªùi ti·∫øt (c·∫ßn API key)
                            <button onclick="testAPI('weather')" class="btn btn-primary btn-sm">üå§Ô∏è Test</button>
                        </div>
                        <div class="api-item">
                            <strong>Quote API:</strong> Quotes ƒë·ªông l·ª±c
                            <button onclick="testAPI('quotes')" class="btn btn-primary btn-sm">üí¨ Test</button>
                        </div>
                        <div class="api-item">
                            <strong>Cat Facts:</strong> S·ª± th·∫≠t th√∫ v·ªã (gi·∫£i tr√≠)
                            <button onclick="testAPI('catfacts')" class="btn btn-primary btn-sm">üê± Test</button>
                        </div>
                    </div>
                </div>

                <!-- Data Export/Import -->
                <div class="database-card">
                    <h3>üì§ Xu·∫•t/Nh·∫≠p D·ªØ Li·ªáu</h3>
                    <div class="data-controls">
                        <button onclick="exportAllData()" class="btn btn-success">üì• Xu·∫•t T·∫•t C·∫£ D·ªØ Li·ªáu</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(this)">
                        <button onclick="document.getElementById('importFile').click()" class="btn btn-info">üì§ Nh·∫≠p D·ªØ Li·ªáu</button>
                        <button onclick="backupToCloud()" class="btn btn-primary">‚òÅÔ∏è Backup Cloud</button>
                    </div>
                </div>

                <!-- Real-time Sync -->
                <div class="database-card">
                    <h3>üîÑ ƒê·ªìng B·ªô Real-time</h3>
                    <div class="sync-controls">
                        <div class="sync-status">
                            <span>Tr·∫°ng th√°i: </span>
                            <span id="syncStatus" class="status-offline">Offline</span>
                        </div>
                        <button id="enableSync" onclick="toggleSync()" class="btn btn-primary">üîÑ B·∫≠t ƒê·ªìng B·ªô</button>
                        <button onclick="forcSync()" class="btn btn-warning">‚ö° ƒê·ªìng B·ªô Ngay</button>
                    </div>
                    <div id="syncLog" class="sync-log">
                        <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông ƒë·ªìng b·ªô</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced JavaScript Loading -->
    <script>
        // Check for critical features before loading main scripts
        function checkSystemRequirements() {
            const results = {
                webgl: false,
                getUserMedia: false,
                wasm: false,
                indexedDB: false,
                localStorage: false
            };
            
            // Check WebGL
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                results.webgl = !!gl;
            } catch (e) {}
            
            // Check getUserMedia
            results.getUserMedia = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
            
            // Check WebAssembly
            results.wasm = typeof WebAssembly === 'object';
            
            // Check IndexedDB
            results.indexedDB = 'indexedDB' in window;
            
            // Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                results.localStorage = true;
            } catch (e) {}
            
            return results;
        }
        
        // Display system check results
        function runSystemCheck() {
            const results = checkSystemRequirements();
            const systemCheck = document.getElementById('systemCheck');
            const systemDetails = document.getElementById('systemDetails');
            
            let html = '<div class="system-results">';
            
            Object.entries(results).forEach(([feature, supported]) => {
                const icon = supported ? '‚úÖ' : '‚ùå';
                const status = supported ? 'H·ªó tr·ª£' : 'Kh√¥ng h·ªó tr·ª£';
                const featureNames = {
                    webgl: 'WebGL (GPU acceleration)',
                    getUserMedia: 'Camera API',
                    wasm: 'WebAssembly',
                    indexedDB: 'IndexedDB',
                    localStorage: 'LocalStorage'
                };
                
                html += `<div>${icon} <strong>${featureNames[feature]}:</strong> ${status}</div>`;
            });
            
            html += '</div>';
            
            // Add browser info
            html += '<br><strong>Th√¥ng tin tr√¨nh duy·ªát:</strong><br>';
            html += `User Agent: ${navigator.userAgent}<br>`;
            html += `Platform: ${navigator.platform}<br>`;
            html += `Language: ${navigator.language}`;
            
            systemDetails.innerHTML = html;
            systemCheck.style.display = 'block';
            
            // Show troubleshooting if there are issues
            if (!results.webgl || !results.getUserMedia) {
                document.getElementById('troubleshooting').style.display = 'block';
            }
        }
        
        // Initialize system check on load
        document.addEventListener('DOMContentLoaded', () => {
            const requirements = checkSystemRequirements();
            console.log('System Requirements Check:', requirements);
            
            // Show warnings for missing features
            if (!requirements.webgl) {
                console.warn('WebGL not supported - AI will use CPU backend');
            }
            if (!requirements.getUserMedia) {
                console.error('Camera API not supported - App cannot function');
            }
        });
    </script>
    
    <!-- Load enhanced configuration -->
    <script src="js/config-enhanced.js"></script>
    
    <!-- Load enhanced modules -->
    <script src="js/camera-enhanced.js"></script>
    <script src="js/emotions.js"></script>
    <script src="js/productivity.js"></script>
    <script src="js/ai-assistant.js"></script>
    
    <!-- Load main application -->
    <script src="js/app-fixed.js"></script>
    
    <!-- Enhanced error handling -->
    <script>
        // Global error handler
        window.onerror = function(msg, url, line, col, error) {
            console.error('Global Error:', { msg, url, line, col, error });
            
            // Show user-friendly error message
            const statusText = document.getElementById('statusText');
            if (statusText && !statusText.textContent.includes('L·ªói')) {
                statusText.textContent = 'ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng t·∫£i l·∫°i trang!';
            }
            
            return true;
        };
        
        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled Promise Rejection:', event.reason);
            event.preventDefault();
        });
    </script>
</body>
</html>
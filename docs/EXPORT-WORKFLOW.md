# ğŸ“Š Luá»“ng Xuáº¥t BÃ¡o CÃ¡o PDF

## Tá»•ng quan

á»¨ng dá»¥ng Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»ƒ **chá»‰ cho phÃ©p xuáº¥t bÃ¡o cÃ¡o PDF sau khi káº¿t thÃºc phiÃªn lÃ m viá»‡c**. Äiá»u nÃ y Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘Æ°á»£c hoÃ n chá»‰nh vÃ  chÃ­nh xÃ¡c trÆ°á»›c khi xuáº¥t.

## Luá»“ng hoáº¡t Ä‘á»™ng

### 1. Tráº¡ng thÃ¡i ban Ä‘áº§u
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChÆ°a Ä‘Äƒng nháº­p                         â”‚
â”‚  âŒ NÃºt "Xuáº¥t PDF" bá»‹ vÃ´ hiá»‡u hÃ³a       â”‚
â”‚  Tooltip: "Vui lÃ²ng Ä‘Äƒng nháº­p..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Sau khi Ä‘Äƒng nháº­p
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ÄÃ£ Ä‘Äƒng nháº­p                           â”‚
â”‚  âŒ NÃºt "Xuáº¥t PDF" váº«n bá»‹ vÃ´ hiá»‡u hÃ³a   â”‚
â”‚  (ChÆ°a cÃ³ phiÃªn lÃ m viá»‡c)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Trong phiÃªn lÃ m viá»‡c (Camera Ä‘ang cháº¡y)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ÄÃ£ Ä‘Äƒng nháº­p + Camera Ä‘ang cháº¡y        â”‚
â”‚  âŒ NÃºt "Xuáº¥t PDF" bá»‹ vÃ´ hiá»‡u hÃ³a       â”‚
â”‚  Tooltip: "Vui lÃ²ng káº¿t thÃºc phiÃªn..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Sau khi káº¿t thÃºc phiÃªn lÃ m viá»‡c
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ÄÃ£ Ä‘Äƒng nháº­p + Camera Ä‘Ã£ dá»«ng          â”‚
â”‚  âœ… NÃºt "Xuáº¥t PDF" Ä‘Æ°á»£c kÃ­ch hoáº¡t       â”‚
â”‚  ğŸ’¬ Hiá»ƒn thá»‹ popup thÃ´ng bÃ¡o            â”‚
â”‚     "PhiÃªn lÃ m viá»‡c Ä‘Ã£ káº¿t thÃºc!"       â”‚
â”‚     "Báº¡n cÃ³ thá»ƒ xuáº¥t bÃ¡o cÃ¡o PDF..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Äiá»u kiá»‡n Ä‘á»ƒ xuáº¥t PDF

### Äiá»u kiá»‡n báº¯t buá»™c:

1. âœ… **ÄÃ£ Ä‘Äƒng nháº­p** vÃ o há»‡ thá»‘ng
2. âœ… **Camera Ä‘Ã£ dá»«ng** (phiÃªn lÃ m viá»‡c Ä‘Ã£ káº¿t thÃºc)

### Kiá»ƒm tra trong code:

```javascript
// Trong hÃ m exportProductivityReport()
if (!window.apiClient || !window.apiClient.isAuthenticated()) {
    alert('âš ï¸ Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xuáº¥t bÃ¡o cÃ¡o!');
    return;
}

if (window.emotionApp && window.emotionApp.isRunning) {
    alert('âš ï¸ Vui lÃ²ng káº¿t thÃºc phiÃªn lÃ m viá»‡c trÆ°á»›c khi xuáº¥t bÃ¡o cÃ¡o!');
    return;
}
```

## ThÃ´ng bÃ¡o káº¿t thÃºc phiÃªn

Khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt **"Dá»«ng"** Ä‘á»ƒ káº¿t thÃºc phiÃªn lÃ m viá»‡c, má»™t popup Ä‘áº¹p máº¯t sáº½ xuáº¥t hiá»‡n vá»›i:

### Ná»™i dung popup:
- ğŸ‰ Icon Äƒn má»«ng
- **TiÃªu Ä‘á»**: "PhiÃªn lÃ m viá»‡c Ä‘Ã£ káº¿t thÃºc!"
- **ThÃ´ng tin**:
  - Thá»i lÆ°á»£ng lÃ m viá»‡c (giá», phÃºt, giÃ¢y)
  - Äiá»ƒm táº­p trung (0-100)
- **Gá»£i Ã½**: "âœ¨ Báº¡n cÃ³ thá»ƒ xuáº¥t bÃ¡o cÃ¡o PDF ngay bÃ¢y giá»!"
- **NÃºt hÃ nh Ä‘á»™ng**:
  - ğŸ“„ "Xuáº¥t PDF ngay" - Xuáº¥t bÃ¡o cÃ¡o trá»±c tiáº¿p
  - "ÄÃ³ng" - ÄÃ³ng popup

### Äáº·c Ä‘iá»ƒm popup:
- Xuáº¥t hiá»‡n giá»¯a mÃ n hÃ¬nh vá»›i hiá»‡u á»©ng slide-in
- Tá»± Ä‘á»™ng Ä‘Ã³ng sau 10 giÃ¢y
- CÃ³ thá»ƒ Ä‘Ã³ng thá»§ cÃ´ng báº±ng nÃºt "ÄÃ³ng"
- Thiáº¿t káº¿ gradient Ä‘áº¹p máº¯t (purple/blue)

## Ghi chÃº hiá»ƒn thá»‹

Trong pháº§n **Quick Actions**, cÃ³ ghi chÃº rÃµ rÃ ng:

```
âš ï¸ Chá»‰ cÃ³ thá»ƒ xuáº¥t bÃ¡o cÃ¡o khi:
  â€¢ ÄÃ£ Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng
  â€¢ ÄÃ£ káº¿t thÃºc phiÃªn lÃ m viá»‡c (camera Ä‘Ã£ dá»«ng)
```

## Cáº­p nháº­t tráº¡ng thÃ¡i nÃºt

HÃ m `updateExportButtons()` Ä‘Æ°á»£c gá»i tá»± Ä‘á»™ng khi:
- NgÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p/Ä‘Äƒng xuáº¥t
- PhiÃªn lÃ m viá»‡c báº¯t Ä‘áº§u
- **PhiÃªn lÃ m viá»‡c káº¿t thÃºc** â† Má»šI

```javascript
// Trong ProductivityTracker.endSession()
if (typeof updateExportButtons === 'function') {
    updateExportButtons();
}
```

## Tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng

### Ká»‹ch báº£n thÃ´ng thÆ°á»ng:

1. **ÄÄƒng nháº­p** â†’ NÃºt PDF váº«n táº¯t
2. **Nháº¥n "Báº¯t Ä‘áº§u"** â†’ Camera cháº¡y, nÃºt PDF váº«n táº¯t
3. **LÃ m viá»‡c** â†’ á»¨ng dá»¥ng ghi nháº­n cáº£m xÃºc
4. **Nháº¥n "Dá»«ng"** â†’ 
   - Popup xuáº¥t hiá»‡n thÃ´ng bÃ¡o káº¿t thÃºc
   - NÃºt PDF Ä‘Æ°á»£c báº­t
   - CÃ³ thá»ƒ xuáº¥t ngay tá»« popup hoáº·c sau nÃ y

### Lá»£i Ã­ch:

âœ… **Dá»¯ liá»‡u Ä‘áº§y Ä‘á»§**: Äáº£m báº£o phiÃªn lÃ m viá»‡c hoÃ n chá»‰nh trÆ°á»›c khi xuáº¥t
âœ… **UX tá»‘t**: Popup gá»£i Ã½ rÃµ rÃ ng, khÃ´ng báº¯t buá»™c xuáº¥t ngay
âœ… **Linh hoáº¡t**: CÃ³ thá»ƒ xuáº¥t ngay hoáº·c Ä‘á»ƒ sau
âœ… **RÃµ rÃ ng**: Ghi chÃº vÃ  tooltip giáº£i thÃ­ch rÃµ Ä‘iá»u kiá»‡n

## Testing

### Test case 1: ChÆ°a Ä‘Äƒng nháº­p
```
1. Má»Ÿ á»©ng dá»¥ng (chÆ°a Ä‘Äƒng nháº­p)
2. Kiá»ƒm tra nÃºt "Xuáº¥t PDF"
   âœ… Expected: NÃºt bá»‹ vÃ´ hiá»‡u hÃ³a
   âœ… Expected: Tooltip hiá»ƒn thá»‹ "Vui lÃ²ng Ä‘Äƒng nháº­p..."
```

### Test case 2: ÄÃ£ Ä‘Äƒng nháº­p, chÆ°a cÃ³ phiÃªn
```
1. ÄÄƒng nháº­p
2. ChÆ°a nháº¥n "Báº¯t Ä‘áº§u"
3. Kiá»ƒm tra nÃºt "Xuáº¥t PDF"
   âœ… Expected: NÃºt bá»‹ vÃ´ hiá»‡u hÃ³a
```

### Test case 3: Trong phiÃªn lÃ m viá»‡c
```
1. ÄÄƒng nháº­p
2. Nháº¥n "Báº¯t Ä‘áº§u" camera
3. Kiá»ƒm tra nÃºt "Xuáº¥t PDF"
   âœ… Expected: NÃºt bá»‹ vÃ´ hiá»‡u hÃ³a
   âœ… Expected: Tooltip "Vui lÃ²ng káº¿t thÃºc phiÃªn..."
4. Thá»­ click nÃºt "Xuáº¥t PDF"
   âœ… Expected: Alert xuáº¥t hiá»‡n thÃ´ng bÃ¡o pháº£i dá»«ng camera
```

### Test case 4: Káº¿t thÃºc phiÃªn lÃ m viá»‡c
```
1. ÄÄƒng nháº­p
2. Nháº¥n "Báº¯t Ä‘áº§u" camera
3. LÃ m viá»‡c má»™t lÃºc
4. Nháº¥n "Dá»«ng"
   âœ… Expected: Popup xuáº¥t hiá»‡n vá»›i thÃ´ng tin phiÃªn
   âœ… Expected: Hiá»ƒn thá»‹ thá»i lÆ°á»£ng vÃ  Ä‘iá»ƒm táº­p trung
   âœ… Expected: CÃ³ nÃºt "Xuáº¥t PDF ngay"
   âœ… Expected: Popup tá»± Ä‘Ã³ng sau 10 giÃ¢y
5. Kiá»ƒm tra nÃºt "Xuáº¥t PDF" á»Ÿ sidebar
   âœ… Expected: NÃºt Ä‘Æ°á»£c kÃ­ch hoáº¡t
6. Click nÃºt "Xuáº¥t PDF"
   âœ… Expected: BÃ¡o cÃ¡o PDF Ä‘Æ°á»£c táº¡o vÃ  táº£i xuá»‘ng
```

### Test case 5: Popup xuáº¥t PDF ngay
```
1. Káº¿t thÃºc phiÃªn lÃ m viá»‡c
2. Popup xuáº¥t hiá»‡n
3. Click "Xuáº¥t PDF ngay" trong popup
   âœ… Expected: PDF Ä‘Æ°á»£c táº¡o ngay láº­p tá»©c
   âœ… Expected: Popup Ä‘Ã³ng
```

## Code liÃªn quan

### Files Ä‘Ã£ sá»­a Ä‘á»•i:

1. **`js/productivity.js`**
   - ThÃªm hÃ m `showSessionEndNotification()`
   - Cáº­p nháº­t hÃ m `endSession()` Ä‘á»ƒ hiá»ƒn thá»‹ popup

2. **`index.html`**
   - ÄÃ£ cÃ³ logic `updateExportButtons()`
   - ÄÃ£ cÃ³ kiá»ƒm tra trong `exportProductivityReport()`
   - ÄÃ£ cÃ³ ghi chÃº trong UI

### Functions quan trá»ng:

```javascript
// productivity.js
endSession() {
    // ... káº¿t thÃºc phiÃªn
    this.showSessionEndNotification(sessionDuration);
    if (typeof updateExportButtons === 'function') {
        updateExportButtons();
    }
}

showSessionEndNotification(sessionDuration) {
    // Táº¡o vÃ  hiá»ƒn thá»‹ popup Ä‘áº¹p
}

// index.html
updateExportButtons() {
    // Cáº­p nháº­t tráº¡ng thÃ¡i enable/disable
}

exportProductivityReport(type) {
    // Kiá»ƒm tra Ä‘iá»u kiá»‡n trÆ°á»›c khi xuáº¥t
}
```

## Troubleshooting

### Váº¥n Ä‘á»: NÃºt PDF khÃ´ng báº­t sau khi dá»«ng camera
**Giáº£i phÃ¡p**: 
- Kiá»ƒm tra `window.emotionApp.isRunning` cÃ³ chuyá»ƒn vá» `false` khÃ´ng
- Kiá»ƒm tra hÃ m `updateExportButtons()` cÃ³ Ä‘Æ°á»£c gá»i khÃ´ng
- Xem Console log

### Váº¥n Ä‘á»: Popup khÃ´ng xuáº¥t hiá»‡n
**Giáº£i phÃ¡p**:
- Kiá»ƒm tra `endSession()` cÃ³ Ä‘Æ°á»£c gá»i khÃ´ng
- Kiá»ƒm tra `showSessionEndNotification()` cÃ³ lá»—i khÃ´ng
- Xem Console log

### Váº¥n Ä‘á»: Váº«n xuáº¥t Ä‘Æ°á»£c PDF khi camera Ä‘ang cháº¡y
**Giáº£i phÃ¡p**:
- Logic kiá»ƒm tra Ä‘Ã£ cÃ³ trong `exportProductivityReport()`
- KhÃ´ng nÃªn xáº£y ra náº¿u code Ä‘Ãºng

## Tá»•ng káº¿t

Luá»“ng xuáº¥t bÃ¡o cÃ¡o Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a Ä‘á»ƒ:
- âœ… Äáº£m báº£o dá»¯ liá»‡u Ä‘áº§y Ä‘á»§
- âœ… UX thÃ¢n thiá»‡n vá»›i popup gá»£i Ã½
- âœ… RÃµ rÃ ng, dá»… hiá»ƒu cho ngÆ°á»i dÃ¹ng
- âœ… Linh hoáº¡t (xuáº¥t ngay hoáº·c sau)
